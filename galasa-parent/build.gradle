plugins {
    id 'java'
    id 'biz.aQute.bnd.builder' version '5.3.0' apply false
    id 'dev.galasa.githash' version '0.15.0' apply false
}

repositories {
    gradlePluginPortal()
    mavenCentral()
    maven {
        url "https://development.galasa.dev/main/maven-repo/obr/"
    }
    mavenLocal()
}

dependencies {
    // We need the openapi generator to generate API documentation from the openapi.yaml file
    // https://mvnrepository.com/artifact/org.openapitools/openapi-generator
    compileClasspath group: 'org.openapitools', name: 'openapi-generator-cli', version: '6.1.0'
}

task downloadDependencies(type: Copy) {
    // Download the dependencies onto the local disk.
    from configurations.compileClasspath
    into 'build/dependencies'
    dependsOn configurations.compileClasspath
}

gradle.taskGraph.beforeTask { Task task ->
   task.ext.setProperty("startTime", new java.util.Date())
}

gradle.taskGraph.afterTask { Task task, TaskState state ->
    int secs = ( new java.util.Date().getTime() - task.ext.startTime.getTime() ) / 1000
    int mins = secs / 60

    int sec = secs - mins * 60
    println " -> took " + mins + ( ( 1 == mins ) ? " min " : " mins " ) + sec + ( ( 1 == sec ) ? " sec" : " secs" )
}

allprojects {
   tasks.withType(Javadoc) {
      options.addStringOption('Xdoclint:none', '-quiet')
   }
}
